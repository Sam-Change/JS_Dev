<!-- jsTestIndex -->
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>jsTestIndex</title>
</head>

<body>
  <!--畫面組成-->
  <!--span id(document.getElementById)為web端儲存資料欄位名稱，會一直撈此欄位資料當欄位值改變就會更新?-->
  <p>SoftMobile TestWebView0511_40</p>
  <div>點擊要呼叫getTestPageData前:<span id="beforeCall"></span></div>
  <div>點擊呼叫getTestPageData後:<span id="afterCall"></span></div>
  <div>PageData資料(tokenFromJS):<span id="tokenFromJS"></span></div> 
  <div>PageData資料(tokenFromLocalStorage):<span id="tokenFromLocalStorage"></span></div>
  <button class="button_style button_y60" onclick="getTestPageData()">要資料getTestPageData()</button>
  <button class="button_style button_y70" onclick="goHome()">返回首頁goHome()</button>
  <button class="button_style button_y80" onclick="onOCR()">OCR辨識onOCR(ocrType:)</button>
  
  <script>
    // const tokenFromLocalStorage = window.localStorage.getItem('jwtToken');
    // let jwtToken = window.localStorage.getItem('jwtToken');
    // jwtToken.addEventListener("change", getLSJwtToken());

    // 在onload執行完前，點擊畫面上button都不會有反應?
    // window.onload = init() {
//       onLoadingY();
//       var jwtToken = window.localStorage.getItem('jwtToken');
//       let dataObj = JSON.parse(jwtToken);
//       document.getElementById("tokenFromLocalStorage").innerHTML = dataObj["auth"];
//       onLoadingN();
    // }
    // window.onload = init() {
    //   let dt = new Date();
    //   console.log(dt.getUTCHours()+8 + ":" + dt.getMinutes() + ":" + dt.getSeconds() + "." + dt.getMilliseconds() + "window.onload")
    //   document.getElementById("CallStatus").innerHTML = "未呼叫"
    //   let dt2 = new Date();
    //   console.log(dt2.getUTCHours()+8 + ":" + dt2.getMinutes() + ":" + dt2.getSeconds() + "." + dt2.getMilliseconds() + "window.onload塞完資料")
    // }

    // 剛進網頁呼叫方法
    // 非同步請求範例(jQuery寫法)
    // window.onload = function() {
    //   $ajax({
    //     type: "", // POST或GET
    //     url: "", // 呼叫網址
    //     data: {}, // 傳送的資料
    //     success: function(){
    //      // 成功時的處理
    //     },
    //     error: function(error){
    //      // 錯誤處理(顯示提示訊息等等)
    //     } 
    //   });
    // } 
    //
    // window.onload = function() {
    //   var success = a();
    //   // 呼叫app端方法
    //   function a(){
    //     let value = "";
    //     return value;
    //   }
    //   if(!success){
    //    // 錯誤處理
    //   }
    // }

    

    
    //<div>PageData資料(tokenFromLocalStorage):func getLSJwtToken()</span></div>
    // function getLSJwtToken() {
    //   let jwtToken = window.localStorage.getItem('jwtToken');
    //   if jwtToken != null { 
    //     if jwtToken.length() > 0 {
    //       let dataObj = JSON.parse(jwtToken);
    //       document.getElementById("tokenFromLocalStorage").innerHTML = dataObj["auth"]; 
    //     }
    //     else {
    //      document.getElementById("tokenFromLocalStorage").innerHTML = "No Data"; 
    //     }
    //   }
    //   else {
    //     document.getElementById("tokenFromLocalStorage").innerHTML = "No Data"; 
    //   }
    // }

    var ideviceCheck = isiOSDevice()
    function isiOSDevice() {
      const mobileDevice = ['iPhone', 'iPad', 'iPod']
      let isMobileDevice = mobileDevice.some(e => navigator.userAgent.match(e))
      return isMobileDevice
    }
    
    function packet_onLoadingData(str) {
      let data = {"open": str}
      return data
    }

    let packet_onLoadingY = {
      "name": "onLoading",
      "data": JSON.stringify(packet_onLoadingData("Y"))
    }
    
    let packet_onLoadingN = {
      "name": "onLoading", 
      "data": JSON.stringify(packet_onLoadingData("N"))
    }
    
    function onLoadingY() {
      if (ideviceCheck) {
        var action = JSON.stringify(packet_onLoadingY);
        window.webkit.messageHandlers.jstoapp.postMessage(action);
      }
      else {
        if (jstoapp) {
          var action = JSON.stringify(packet_onLoadingData("Y"));
          jstoapp.onLoadingY(action);
        }
      }
    }

    function onLoadingN() {
      if (ideviceCheck) {
        var action = JSON.stringify(packet_onLoadingN);
        window.webkit.messageHandlers.jstoapp.postMessage(action);
      }
      else {
        if (jstoapp) {
          var action = JSON.stringify(packet_onLoadingData("N"));
          jstoapp.onLoadingN(action);
        }
      }
    }
    
    let packet_getTestPageData = {
      "name": "getTestPageData",
    }

    function getTestPageData() {
      let dt = new Date();
      let strLog = dt.getUTCHours()+8 + ":" + dt.getMinutes() + ":" + dt.getSeconds() + "." + dt.getMilliseconds();
      console.log(strLog + " 呼叫getTestPageData前")
      document.getElementById("beforeCall").innerHTML = strLog
      if (ideviceCheck) {
        var action = JSON.stringify(packet_getTestPageData);
        window.webkit.messageHandlers.jstoapp.postMessage(action);
        let dt2 = new Date();
        let strLog2 = dt2.getUTCHours()+8 + ":" + dt2.getMinutes() + ":" + dt2.getSeconds() + "." + dt2.getMilliseconds();
        console.log(strLog2 + " 呼叫getTestPageData後")
        document.getElementById("afterCall").innerHTML = strLog2
      }
      else {
        if (jstoapp) {
          jstoapp.getTestPageData();
          let dt2 = new Date();
          let strLog2 = dt2.getUTCHours()+8 + ":" + dt2.getMinutes() + ":" + dt2.getSeconds() + "." + dt2.getMilliseconds();
          console.log(strLog2 + " 呼叫getTestPageData後")
          document.getElementById("afterCall").innerHTML = strLog2
        }
      }
    }

    let packet_goHome = {
      "name": "goHome",
    }

    function goHome() {
      if (ideviceCheck) {
        var action = JSON.stringify(packet_goHome);
        window.webkit.messageHandlers.jstoapp.postMessage(action);
      }
      else {
        if (jstoapp) {
          jstoapp.goHome();
        }
      }
    }

    let packet_onOCRData = {
      "ocrType": 1,
    }

    let packet_onOCR = {
      "name": "onOCR",
      "data": JSON.stringify(packet_onOCRData),
    }

    function onOCR() {
      if (ideviceCheck) {
        var action = JSON.stringify(packet_onOCR);
        window.webkit.messageHandlers.jstoapp.postMessage(action);
      }
      else {
        if (jstoapp) {
          var action = JSON.stringify(packet_onOCRData);
          jstoapp.onOCR(action);
        }
      }
    }
    
    // 收JS
    function setTestPageData(data) {
      document.getElementById("tokenFromJS").innerHTML = data["token"]

      let jwtToken = window.localStorage.getItem('jwtToken');
      // if jwtToken != null { 
      //   if jwtToken.length() > 0 {
          let dataObj = JSON.parse(jwtToken);
          document.getElementById("tokenFromLocalStorage").innerHTML = dataObj["auth"]; 
      //   }
      // }
    }
  </script>
</body>
  
<style>
  .button_style {
    position: absolute;
    width: 100%;
    left: 0%;
    top: 0%;
    height: 10%;
  }
  .button_y10 {
    top: 10%;
  }
  .button_y20 {
    top: 20%;
  }
  .button_y30 {
    top: 30%;
  }
  .button_y40 {
    top: 40%;
  }
  .button_y50 {
    top: 50%;
  }
  .button_y60 {
    top: 60%;
  }
  .button_y70 {
    top: 70%;
  }
  .button_y80 {
    top: 80%;
  }
  .button_y90 {
    top: 90%;
  }
</style>
  
</html>
